{% extends "base.html" %}
{% block title %}Ph√¢n t√≠ch AI{% endblock %}
{% block content %}
<div class="form-container" style="max-width: 900px;">
    <h2>ü§ñ Ph√¢n t√≠ch T√†i ch√≠nh b·∫±ng AI</h2>
    <p style="color: #6b7280; margin-bottom: 24px;">
        AI s·∫Ω ph√¢n t√≠ch thu nh·∫≠p, chi ti√™u v√† ƒë∆∞a ra g·ª£i √Ω k·∫ø ho·∫°ch ti·∫øt ki·ªám d·ª±a tr√™n m·ª•c ti√™u c·ªßa b·∫°n.
    </p>
    
    <button id="analyzeBtn" class="btn btn-primary" onclick="runAnalysis()">
        üîç B·∫Øt ƒë·∫ßu ph√¢n t√≠ch
    </button>
    
    <div id="loading" style="display:none; text-align:center; margin:30px 0;">
        <p>‚è≥ ƒêang ph√¢n t√≠ch... (c√≥ th·ªÉ m·∫•t 10-20 gi√¢y)</p>
    </div>
    
    <div id="result" style="display:none; margin-top:30px;">
        <h3>üìä K·∫øt qu·∫£ ph√¢n t√≠ch:</h3>
        <div id="analysisContent" style="background:#f9fafb; padding:20px; border-radius:8px; white-space:pre-wrap; line-height:1.8;">
        </div>
    </div>
    
    <div id="error" style="display:none; margin-top:20px;" class="alert alert-error"></div>
</div>

<script>
async function runAnalysis() {
    const btn = document.getElementById('analyzeBtn');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const error = document.getElementById('error');
    const content = document.getElementById('analysisContent');
    
    btn.disabled = true;
    loading.style.display = 'block';
    result.style.display = 'none';
    error.style.display = 'none';
    
    try {
        const response = await fetch('/ai/analyze/run', { method: 'POST' });
        const data = await response.json();
        
        if (data.success) {
            content.innerHTML = data.analysis.replace(/\n/g, '<br>');
            result.style.display = 'block';
        } else {
            error.textContent = 'L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ ph√¢n t√≠ch');
            error.style.display = 'block';
        }
    } catch (err) {
        error.textContent = 'L·ªói k·∫øt n·ªëi: ' + err.message;
        error.style.display = 'block';
    } finally {
        btn.disabled = false;
        loading.style.display = 'none';
    }
}
</script>
{% endblock %}